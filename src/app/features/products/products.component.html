<h2>Product Management</h2>

<!-- Toast -->
<div *ngIf="toastMessage" class="toast">
  {{ toastMessage }}
</div>

<!-- Loading -->
<div *ngIf="loading">Loading...</div>

<!-- Error Banner -->
<div *ngIf="error" class="error-banner">
  <span>{{ error }}</span>
  <button (click)="error = null">âœ–</button>
</div>

<!-- ===================== FORM ===================== -->

<h3>
  {{ editMode ? 'Edit Product' : 'Create Product' }}
</h3>

<form [formGroup]="form" (ngSubmit)="submit()">

  <input
    placeholder="SKU"
    formControlName="sku"
    [readonly]="editMode"
  />

  <input
    placeholder="Product Name"
    formControlName="name"
  />

  <input
    type="number"
    step="0.01"
    placeholder="Price"
    formControlName="price"
  />

  <button type="submit" [disabled]="form.invalid || loading">
    {{ editMode ? 'Update' : 'Create' }}
  </button>

</form>

<hr />

<!-- ===================== SEARCH ===================== -->

<h3>Product List</h3>

<input
  placeholder="Search by name or SKU"
  [(ngModel)]="searchTerm"
/>

<button (click)="applySearch()">Search</button>
<button (click)="loadProducts()">Reset</button>

<hr />

<!-- ===================== TABLE ===================== -->

<table *ngIf="filteredProducts.length > 0">
  <tr>
    <th (click)="sort('sku')">SKU</th>
    <th (click)="sort('name')">Name</th>
    <th (click)="sort('price')">Price</th>
    <th (click)="sort('createdAt')">Created At</th>
    <th>Actions</th>
  </tr>

  <tr *ngFor="let p of paginatedProducts">
    <td>{{ p.sku }}</td>
    <td>{{ p.name }}</td>
    <td>{{ p.price }}</td>
    <td>{{ p.createdAt | date:'short' }}</td>
    <td>
      <button (click)="editProduct(p)">
        Edit
      </button>

      <button (click)="confirmDelete(p.id)">
        Delete
      </button>
    </td>
  </tr>
</table>

<div *ngIf="!loading && filteredProducts.length === 0">
  No products found.
</div>

<!-- ===================== PAGINATION ===================== -->

<div class="pagination" *ngIf="filteredProducts.length > pageSize">

  <button
    (click)="currentPage = currentPage - 1"
    [disabled]="currentPage === 1">
    Previous
  </button>

  <span>Page {{ currentPage }}</span>

  <button
    (click)="currentPage = currentPage + 1"
    [disabled]="currentPage * pageSize >= filteredProducts.length">
    Next
  </button>

</div>

<!-- ===================== DELETE CONFIRM MODAL ===================== -->

<div *ngIf="showConfirmModal" class="modal-backdrop">
  <div class="modal">
    <p>Are you sure you want to delete this product?</p>

    <button (click)="deleteProduct()">Yes</button>
    <button (click)="cancelDelete()">Cancel</button>
  </div>
</div>
