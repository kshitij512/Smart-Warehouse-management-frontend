<h2 class="page-title">
  Product Management
</h2>

<!-- Toast -->
<div *ngIf="toastMessage" class="toast">
  {{ toastMessage }}
</div>

<!-- Error Banner -->
<div *ngIf="error" class="error-banner">
  <span>{{ error }}</span>
  <button class="btn-red small" (click)="error = null">âœ–</button>
</div>

<!-- ===================== CREATE / EDIT FORM ===================== -->

<div class="card">

  <h3>
    {{ editMode ? 'Edit Product' : 'Create Product' }}
  </h3>

  <form [formGroup]="form"
        (ngSubmit)="submit()"
        class="form-grid">

    <input
      placeholder="SKU"
      formControlName="sku"
      [readonly]="editMode"
    />

    <input
      placeholder="Product Name"
      formControlName="name"
    />

    <input
      type="number"
      step="0.01"
      placeholder="Price"
      formControlName="price"
    />

    <button class="btn-yellow"
            type="submit"
            [disabled]="form.invalid || loading">
      {{ editMode ? 'Update' : 'Create' }}
    </button>

  </form>

</div>

<!-- ===================== SEARCH ===================== -->

<div class="card">

  <h3>Product List</h3>

  <div class="search-row">

    <input
      placeholder="Search by name or SKU"
      [(ngModel)]="searchTerm"
    />

    <button class="btn-yellow"
            (click)="applySearch()">
      Search
    </button>

    <button class="btn-red"
            (click)="loadProducts()">
      Reset
    </button>

  </div>

</div>

<!-- ===================== TABLE ===================== -->

<table *ngIf="filteredProducts.length > 0">

  <tr>
    <th (click)="sort('sku')">SKU</th>
    <th (click)="sort('name')">Name</th>
    <th (click)="sort('price')">Price</th>
    <th (click)="sort('createdAt')">Created At</th>
    <th>Actions</th>
  </tr>

  <tr *ngFor="let p of paginatedProducts">

    <td>{{ p.sku }}</td>
    <td>{{ p.name }}</td>
    <td>{{ p.price }}</td>
    <td>{{ p.createdAt | date:'short' }}</td>

    <td class="action-buttons">

      <button class="btn-yellow small"
              (click)="editProduct(p)">
        Edit
      </button>

      <button class="btn-red small"
              (click)="confirmDelete(p.id)">
        Delete
      </button>

    </td>

  </tr>

</table>

<div *ngIf="!loading && filteredProducts.length === 0">
  No products found.
</div>

<!-- ===================== PAGINATION ===================== -->

<div class="pagination"
     *ngIf="filteredProducts.length > pageSize">

  <button class="btn-yellow small"
          (click)="currentPage = currentPage - 1"
          [disabled]="currentPage === 1">
    Previous
  </button>

  <span>Page {{ currentPage }}</span>

  <button class="btn-yellow small"
          (click)="currentPage = currentPage + 1"
          [disabled]="currentPage * pageSize >= filteredProducts.length">
    Next
  </button>

</div>

<!-- ===================== DELETE CONFIRM MODAL ===================== -->

<div *ngIf="showConfirmModal" class="modal-backdrop">
  <div class="modal card">

    <p>Are you sure you want to delete this product?</p>

    <div class="modal-actions">

      <button class="btn-red"
              (click)="deleteProduct()">
        Yes
      </button>

      <button class="btn-yellow"
              (click)="cancelDelete()">
        Cancel
      </button>

    </div>

  </div>
</div>
