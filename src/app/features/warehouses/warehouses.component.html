<h2>Warehouse Management</h2>

<!-- Toast -->
<div *ngIf="toastMessage" class="toast">
  {{ toastMessage }}
</div>

<!-- Loading -->
<div *ngIf="loading">Loading...</div>

<!-- Error Banner -->
<div *ngIf="error" class="error-banner">
  <span>{{ error }}</span>
  <button (click)="error = null">âœ–</button>
</div>

<!-- ===================== CREATE FORM ===================== -->

<h3>
  {{ editMode ? 'Edit Warehouse' : 'Create Warehouse' }}
</h3>

<form [formGroup]="form" (ngSubmit)="submit()">

  <input placeholder="Name" formControlName="name" />
  <input placeholder="Location" formControlName="location" />
  <input type="number" placeholder="Capacity" formControlName="capacity" />
  <input placeholder="Code" formControlName="code" />
  <input type="number" placeholder="Manager ID" formControlName="managerId" />

  <button type="submit" [disabled]="form.invalid || loading">
    {{ editMode ? 'Update' : 'Create' }}
  </button>

</form>

<hr />

<!-- ===================== SEARCH ===================== -->

<h3>Warehouse List</h3>

<input
  placeholder="Search (name, location, code)"
  [(ngModel)]="searchTerm"
/>

<button (click)="applySearch()">Search</button>
<button (click)="resetSearch()">Reset</button>

<hr />

<!-- ===================== TABLE ===================== -->

<table *ngIf="filteredWarehouses.length > 0">
  <tr>
    <th (click)="sort('name')">Name</th>
    <th (click)="sort('location')">Location</th>
    <th (click)="sort('code')">Code</th>
    <th (click)="sort('capacity')">Capacity</th>
    <th>Manager</th>
    <th>Actions</th>
  </tr>

  <tr *ngFor="let w of paginatedWarehouses">
    <td>{{ w.name }}</td>
    <td>{{ w.location }}</td>
    <td>{{ w.code }}</td>
    <td>{{ w.capacity }}</td>
    <td>{{ w.managerName }}</td>
    <button (click)="editWarehouse(w)">
  Edit
</button>

    <td>
      <button (click)="confirmDelete(w.id)">
        Delete
      </button>
    </td>
  </tr>
</table>

<div *ngIf="!loading && filteredWarehouses.length === 0">
  No warehouses found.
</div>

<!-- ===================== PAGINATION ===================== -->

<div class="pagination" *ngIf="filteredWarehouses.length > pageSize">

  <button
    (click)="currentPage = currentPage - 1"
    [disabled]="currentPage === 1">
    Previous
  </button>

  <span>Page {{ currentPage }}</span>

  <button
    (click)="currentPage = currentPage + 1"
    [disabled]="currentPage * pageSize >= filteredWarehouses.length">
    Next
  </button>

</div>

<!-- ===================== CONFIRM MODAL ===================== -->

<div *ngIf="showConfirmModal" class="modal-backdrop">
  <div class="modal">
    <p>Are you sure you want to delete this warehouse?</p>

    <button (click)="deleteWarehouse()">Yes</button>
    <button (click)="cancelDelete()">Cancel</button>
  </div>
</div>
