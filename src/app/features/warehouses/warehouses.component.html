<h2 class="page-title">
  Warehouse Management
</h2>

<!-- Toast -->
<div *ngIf="toastMessage" class="toast">
  {{ toastMessage }}
</div>

<!-- Error Banner -->
<div *ngIf="error" class="error-banner">
  <span>{{ error }}</span>
  <button class="btn-red small" (click)="error = null">âœ–</button>
</div>

<!-- ===================== CREATE / EDIT FORM ===================== -->

<div class="card">

  <h3>
    {{ editMode ? 'Edit Warehouse' : 'Create Warehouse' }}
  </h3>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">

    <input placeholder="Name" formControlName="name" />
    <input placeholder="Location" formControlName="location" />
    <input type="number" placeholder="Capacity" formControlName="capacity" />
    <input placeholder="Code" formControlName="code" />
    <input type="number" placeholder="Manager ID" formControlName="managerId" />

    <button class="btn-yellow" type="submit"
            [disabled]="form.invalid || loading">
      {{ editMode ? 'Update' : 'Create' }}
    </button>

  </form>

</div>

<!-- ===================== SEARCH ===================== -->

<div class="card">

  <h3>Warehouse List</h3>

  <div class="search-row">
    <input
      placeholder="Search (name, location, code)"
      [(ngModel)]="searchTerm"
    />

    <button class="btn-yellow" (click)="applySearch()">
      Search
    </button>

    <button class="btn-red" (click)="resetSearch()">
      Reset
    </button>
  </div>

</div>

<!-- ===================== TABLE ===================== -->

<table *ngIf="filteredWarehouses.length > 0">

  <tr>
    <th (click)="sort('name')">Name</th>
    <th (click)="sort('location')">Location</th>
    <th (click)="sort('code')">Code</th>
    <th (click)="sort('capacity')">Capacity</th>
    <th>Manager</th>
    <th>Actions</th>
  </tr>

  <tr *ngFor="let w of paginatedWarehouses">

    <td>{{ w.name }}</td>
    <td>{{ w.location }}</td>
    <td>{{ w.code }}</td>
    <td>{{ w.capacity }}</td>
    <td>{{ w.managerName }}</td>

    <td class="action-buttons">

      <button class="btn-yellow small"
              (click)="editWarehouse(w)">
        Edit
      </button>

      <button class="btn-red small"
              (click)="confirmDelete(w.id)">
        Delete
      </button>

    </td>

  </tr>

</table>

<div *ngIf="!loading && filteredWarehouses.length === 0">
  No warehouses found.
</div>

<!-- ===================== PAGINATION ===================== -->

<div class="pagination"
     *ngIf="filteredWarehouses.length > pageSize">

  <button class="btn-yellow small"
          (click)="currentPage = currentPage - 1"
          [disabled]="currentPage === 1">
    Previous
  </button>

  <span>Page {{ currentPage }}</span>

  <button class="btn-yellow small"
          (click)="currentPage = currentPage + 1"
          [disabled]="currentPage * pageSize >= filteredWarehouses.length">
    Next
  </button>

</div>

<!-- ===================== CONFIRM MODAL ===================== -->

<div *ngIf="showConfirmModal" class="modal-backdrop">
  <div class="modal card">

    <p>Are you sure you want to delete this warehouse?</p>

    <div class="modal-actions">
      <button class="btn-red"
              (click)="deleteWarehouse()">
        Yes
      </button>

      <button class="btn-yellow"
              (click)="cancelDelete()">
        Cancel
      </button>
    </div>

  </div>
</div>
