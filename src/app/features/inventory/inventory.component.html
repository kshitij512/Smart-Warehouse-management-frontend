<h2 class="page-title">
  Inventory Management
</h2>

<!-- Toast -->
<div *ngIf="toastMessage" class="toast">
  {{ toastMessage }}
</div>

<!-- Error Banner -->
<div *ngIf="error" class="error-banner">
  <span>{{ error }}</span>
  <button class="btn-red small" (click)="error = null">âœ–</button>
</div>

<!-- ===================== WAREHOUSE SELECT ===================== -->

<div class="card">

  <h3>Select Warehouse</h3>

  <select
    [(ngModel)]="selectedWarehouseId"
    (change)="loadInventory()"
  >
    <option [ngValue]="null">Select Warehouse</option>
    <option *ngFor="let w of warehouses" [ngValue]="w.id">
      {{ w.name }} ({{ w.location }})
    </option>
  </select>

</div>

<!-- ===================== ADD PRODUCT ===================== -->

<div *ngIf="selectedWarehouseId" class="card">

  <h3>Add Product to Warehouse</h3>

  <form [formGroup]="form"
        (ngSubmit)="addProductToWarehouse()"
        class="form-grid">

    <select formControlName="productId">
      <option [ngValue]="null">Select Product</option>
      <option *ngFor="let p of products" [ngValue]="p.id">
        {{ p.name }} ({{ p.sku }})
      </option>
    </select>

    <input
      type="number"
      placeholder="Initial Quantity"
      formControlName="quantity"
    />

    <input
      type="number"
      placeholder="Reorder Threshold"
      formControlName="reorderThreshold"
    />

    <button class="btn-yellow"
            type="submit"
            [disabled]="form.invalid">
      Add Product
    </button>

  </form>

</div>

<!-- ===================== INVENTORY TABLE ===================== -->

<div *ngIf="selectedWarehouseId" class="card">

  <h3>Inventory</h3>

  <table *ngIf="inventory.length > 0">

    <tr>
      <th>Product</th>
      <th>SKU</th>
      <th>Quantity</th>
      <th>Reorder Threshold</th>
      <th>Stock Controls</th>
    </tr>

    <tr *ngFor="let item of inventory"
        [ngClass]="{'low-stock-row': isLowStock(item)}">

      <td>{{ item.productName }}</td>
      <td>{{ item.sku }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.reorderThreshold }}</td>

      <td class="action-buttons">

        <button class="btn-yellow small"
                (click)="updateStock(item.productId, 10)">
          +10
        </button>

        <button class="btn-red small"
                (click)="updateStock(item.productId, -10)">
          -10
        </button>

      </td>

    </tr>

  </table>

  <div *ngIf="!loading && inventory.length === 0">
    No inventory found for this warehouse.
  </div>

</div>
